# 피부 질환 이미지 분석 계획서

## 1. 데이터 개요

### 1.1 데이터 구조

- **Training 데이터**: `/Users/jonabi/Downloads/JLK_DATA/Training`

  - 형식: PNG 이미지 파일 (512x512 픽셀)
  - 총 4,000개 이미지
  - 카테고리별 분포:
    - 광선각화증 (Actinic Keratosis): 800개
    - 기저세포암 (Basal Cell Carcinoma): 800개
    - 멜라닌세포모반 (Melanocytic Nevus): 800개
    - 악성흑색종 (Malignant Melanoma): 800개
    - 혈관종 (Hemangioma): 800개

- **Labeling 데이터**: `/Users/jonabi/Downloads/JLK_DATA/Labeling`
  - 형식: JSON 파일 (주석 및 바운딩 박스 정보 포함)
  - 총 4,800개 JSON 파일
  - 카테고리별 분포:
    - 광선각화증: 800개
    - 기저세포암: 800개
    - 멜라닌세포모반: 800개
    - 보웬병 (Bowen's Disease): 800개
    - 악성흑색종: 800개
    - 혈관종: 800개

### 1.2 JSON 파일 구조

```json
{
  "annotations": [
    {
      "identifier": "Z4_4739_P0_L0",
      "diagnosis_info": {
        "diagnosis_name": "광선각화증",
        "onset": "N/A",
        "distribution": "N/A",
        "bodypart": "N/A",
        "symptom": "N/A",
        "desc": "질환 설명"
      },
      "generated_parameters": {
        "gender": "N/A",
        "age_range": "N/A",
        "bodypart": "N/A",
        "race": "황인"
      },
      "photograph": {
        "file_path": "광선각화증/Z4_4739_P0_L0.png",
        "width": 512,
        "height": 512
      },
      "bbox": {
        "xpos": 12,
        "ypos": 0,
        "file_path": "광선각화증/Z4_4739_P0_L0.png",
        "width": 500,
        "height": 500
      }
    }
  ]
}
```

## 2. 분석 목표

### 2.1 주요 목표

1. **이미지 분류 (Image Classification)**: 피부 질환 이미지를 6개 카테고리로 분류
2. **객체 탐지 (Object Detection)**: 이미지 내 병변 영역을 바운딩 박스로 탐지
3. **병변 세그멘테이션 (Segmentation)**: 병변 영역을 픽셀 단위로 정확히 분할

### 2.2 평가 지표

- **분류**: Accuracy, Precision, Recall, F1-Score, Confusion Matrix
- **객체 탐지**: mAP (mean Average Precision), IoU (Intersection over Union)
- **세그멘테이션**: Dice Score, IoU, Pixel Accuracy

## 3. 데이터 전처리 계획

### 3.1 데이터 통합

- Training 이미지와 Labeling JSON 파일을 매칭
- JSON의 `bbox` 정보를 활용하여 객체 탐지 데이터셋 구성
- 바운딩 박스 좌표를 표준 형식으로 변환 (COCO 또는 YOLO 형식)

### 3.2 데이터 증강 (Data Augmentation)

- 회전 (Rotation): ±15도
- 좌우 반전 (Horizontal Flip)
- 밝기 조정 (Brightness): ±20%
- 대비 조정 (Contrast): ±20%
- 색상 조정 (Color Jitter)
- 가우시안 블러 (Gaussian Blur)
- 노이즈 추가 (Noise Injection)

### 3.3 데이터 분할

- **Train**: 70% (약 5,600개)
- **Validation**: 15% (약 1,200개)
- **Test**: 15% (약 1,200개)
- 각 카테고리별로 균등하게 분할 (Stratified Split)

## 4. 모델 제안

### 4.1 이미지 분류 모델

#### 옵션 1: EfficientNet (권장)

- **이유**: 의료 이미지 분류에서 우수한 성능, 파라미터 효율적
- **모델**: EfficientNet-B4 또는 EfficientNet-B5
- **장점**:
  - 적은 파라미터로 높은 정확도
  - 전이 학습에 적합
  - 의료 이미지에서 검증된 성능

#### 옵션 2: Vision Transformer (ViT)

- **모델**: ViT-Base/16 또는 ViT-Large/16
- **장점**:
  - 최신 아키텍처
  - 글로벌 컨텍스트 이해 능력 우수
- **단점**: 더 많은 데이터와 계산 자원 필요

#### 옵션 3: ResNet + Attention

- **모델**: ResNet-50/101 + CBAM (Convolutional Block Attention Module)
- **장점**:
  - 안정적이고 검증된 아키텍처
  - Attention 메커니즘으로 병변 영역 집중

### 4.2 객체 탐지 모델

#### 옵션 1: YOLOv8 (권장)

- **이유**: 실시간 처리 가능, 높은 정확도, 사용하기 쉬움
- **모델**: YOLOv8m 또는 YOLOv8l
- **장점**:
  - 빠른 추론 속도
  - 좋은 정확도
  - 바운딩 박스 예측에 최적화

#### 옵션 2: Faster R-CNN

- **모델**: Faster R-CNN with ResNet-50/101 backbone
- **장점**:
  - 높은 정확도
  - 의료 이미지에서 널리 사용
- **단점**: YOLO보다 느림

#### 옵션 3: RetinaNet

- **모델**: RetinaNet with ResNet-50/101
- **장점**:
  - Focal Loss로 클래스 불균형 문제 해결
  - 단일 스테이지이면서 높은 정확도

### 4.3 세그멘테이션 모델

#### 옵션 1: U-Net (권장)

- **이유**: 의료 이미지 세그멘테이션의 표준 모델
- **모델**: U-Net with EfficientNet-B4 encoder
- **장점**:
  - 의료 이미지 세그멘테이션에서 검증된 성능
  - 적은 데이터로도 좋은 성능
  - Skip connection으로 디테일 보존

#### 옵션 2: DeepLabV3+

- **모델**: DeepLabV3+ with ResNet-50/101
- **장점**:
  - Atrous convolution으로 다양한 스케일 처리
  - 높은 정확도

#### 옵션 3: SegFormer

- **모델**: SegFormer-B3 또는 SegFormer-B4
- **장점**:
  - Transformer 기반으로 글로벌 컨텍스트 이해
  - 최신 아키텍처

## 5. 구현 단계별 계획

### Phase 1: 데이터 준비 및 탐색적 데이터 분석 (EDA)

1. 데이터 로딩 및 통합 스크립트 작성
2. 데이터 분포 시각화
3. 이미지 샘플 확인 및 통계 분석
4. 바운딩 박스 분포 분석

### Phase 2: 데이터 전처리 파이프라인 구축

1. 이미지 전처리 함수 작성
2. 데이터 증강 파이프라인 구현
3. 데이터 로더 클래스 작성 (PyTorch/TensorFlow)
4. 데이터 분할 및 저장

### Phase 3: 베이스라인 모델 구현

1. **분류 모델**: EfficientNet-B4로 시작
2. 전이 학습 (Transfer Learning) 적용
3. 기본 하이퍼파라미터로 학습
4. 성능 평가 및 베이스라인 확립

### Phase 4: 객체 탐지 모델 구현

1. YOLOv8 모델 설정
2. 데이터를 YOLO 형식으로 변환
3. 모델 학습
4. mAP 및 IoU 평가

### Phase 5: 세그멘테이션 모델 구현

1. U-Net 모델 구현
2. 바운딩 박스를 마스크로 변환 (또는 수동 마스크 생성)
3. 모델 학습
4. Dice Score 및 IoU 평가

### Phase 6: 모델 최적화

1. 하이퍼파라미터 튜닝 (Optuna, Ray Tune 등)
2. 앙상블 모델 구축
3. 모델 압축 및 최적화
4. 최종 성능 평가

## 6. 기술 스택

### 6.1 필수 라이브러리

```python
# 딥러닝 프레임워크
torch / tensorflow
torchvision / tensorflow.keras

# 이미지 처리
opencv-python (cv2)
PIL / Pillow
albumentations  # 데이터 증강

# 객체 탐지
ultralytics  # YOLOv8
detectron2  # Faster R-CNN (선택)

# 데이터 처리
pandas
numpy
json

# 시각화
matplotlib
seaborn
plotly

# 모델 평가
scikit-learn
```

### 6.2 개발 환경

- Python 3.8+
- CUDA 지원 GPU (권장: NVIDIA GPU with 8GB+ VRAM)
- PyTorch 또는 TensorFlow

## 7. 예상 결과 및 활용 방안

### 7.1 예상 성능

- **분류 정확도**: 85-95% (카테고리별로 다를 수 있음)
- **객체 탐지 mAP@0.5**: 0.80-0.90
- **세그멘테이션 Dice Score**: 0.75-0.85

### 7.2 활용 방안

1. **의료진 보조 도구**: 초기 진단 보조 시스템
2. **스크리닝 시스템**: 대량 검진 시 1차 필터링
3. **교육 도구**: 의료진 교육용 시각화 도구
4. **연구 도구**: 질환 패턴 분석 및 연구

## 8. 주의사항 및 제한사항

### 8.1 데이터 관련

- Training과 Labeling 데이터의 카테고리 불일치 (보웬병)
- 일부 메타데이터가 "N/A"로 표시됨
- 바운딩 박스가 거의 동일한 크기 (500x500)로 보임

### 8.2 모델 관련

- 의료 이미지 분석은 높은 정확도가 필수
- 클래스 불균형 가능성 확인 필요
- 오분류 시 심각한 결과 초래 가능 (특히 악성 종양)

### 8.3 윤리적 고려사항

- 의료 AI 모델은 실제 진단에 사용하기 전 의료진 검증 필수
- 환자 프라이버시 보호
- 모델 설명 가능성 (Explainable AI) 고려

## 9. 다음 단계

1. **즉시 시작 가능한 작업**:

   - 데이터 로딩 및 EDA 스크립트 작성
   - 데이터 전처리 파이프라인 구축
   - 베이스라인 분류 모델 구현

2. **단기 목표 (1-2주)**:

   - 베이스라인 모델 학습 및 평가
   - 데이터 증강 전략 수립
   - 초기 결과 분석

3. **중기 목표 (1-2개월)**:

   - 객체 탐지 및 세그멘테이션 모델 구현
   - 모델 최적화 및 앙상블
   - 종합 성능 평가

4. **장기 목표 (3개월+)**:
   - 프로덕션 배포 준비
   - 모델 설명 가능성 구현
   - 의료진 피드백 반영 및 개선
